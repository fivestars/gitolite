from phabricator_vref import PhabricatorVREF


class Peer(PhabricatorVREF):
    CHECK_FAIL_MESSAGE = """
    Ha, nice try.
    Diff for commit {commit_hash}
    did not get an LGTM from a peer.
    Have someone look at it and then we can talk.
    """

    VREF = "VREF/PEER"

    def check(self):
        "Returns False if a commit has not been accepted on Phabricator by not the pusher"
        if not self.require_vref:
            return True

        for commit_hash in self.commit_hashes:
            if not (self.commit_to_acceptors[commit_hash] - set([self.gl_user])):
                self.fail(commit_hash=commit_hash)
                return False

        return True


if __name__ == "__main__":
    import sys
    try:
        Peer(*sys.argv[1:]).check()
        1/0
    except:
        print "VREF/PEER" + "/".join(sys.argv[7:])
        raise
